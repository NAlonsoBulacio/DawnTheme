function _bizjudge_reviews_callback_func(data, sort, filtered) {
    let widget_element = document.getElementById('bizjudge-reviews-widget');
    let widget_type = widget_element.getAttribute("data-widget-type");
    let product_handle = widget_element.getAttribute("data-product-handle");
    let company_rating = data.company_rating;
    let reviews_count = data.reviews_count;
    let company_link = data.company_link;
    let company_name = data.company_name;
    let review_link = data.review_link;
    let product__title = data.product_title;
    sort = sort ? sort : data.sort;
    let reviews_data = data.reviews;
    let error = data.error;
    let widget_html;
    let filters_html;
    let no_reviews_message;
    let review_container_footer;
    let reviews_html = '';

    if (!reviews_data) return error;

    if (widget_type == 'standard-reviews-widget') {
        reviews_data.forEach(review => {
            product__title = review.product__title;
            let verified_badge = '';
            let product_link_html = '';
            author_name = 'Anonymous Customer';
            if (review.is_verified == 'true') {
                verified_badge = '<svg class="bizjudge-verified-badge" height="16" width="16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="badge-check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M512 256c0-37.7-23.7-69.9-57.1-82.4 14.7-32.4 8.8-71.9-17.9-98.6-26.7-26.7-66.2-32.6-98.6-17.9C325.9 23.7 293.7 0 256 0s-69.9 23.7-82.4 57.1c-32.4-14.7-72-8.8-98.6 17.9-26.7 26.7-32.6 66.2-17.9 98.6C23.7 186.1 0 218.3 0 256s23.7 69.9 57.1 82.4c-14.7 32.4-8.8 72 17.9 98.6 26.6 26.6 66.1 32.7 98.6 17.9 12.5 33.3 44.7 57.1 82.4 57.1s69.9-23.7 82.4-57.1c32.6 14.8 72 8.7 98.6-17.9 26.7-26.7 32.6-66.2 17.9-98.6 33.4-12.5 57.1-44.7 57.1-82.4zm-144.8-44.25L236.16 341.74c-4.31 4.28-11.28 4.25-15.55-.06l-75.72-76.33c-4.28-4.31-4.25-11.28.06-15.56l26.03-25.82c4.31-4.28 11.28-4.25 15.56.06l42.15 42.49 97.2-96.42c4.31-4.28 11.28-4.25 15.55.06l25.82 26.03c4.28 4.32 4.26 11.29-.06 15.56z" class=""></path></svg>';
            }

            if (review.product__title != "") {
                product_link_html = `<a href="${review.product_url}" class="bizjudge-product-link" rel="noopener noreferrer"><svg style="vertical-align: middle;" height="16" width="16" aria-hidden="true" focusable="false" data-prefix="fal" data-icon="tags" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M625.941 293.823L421.823 497.941c-18.746 18.746-49.138 18.745-67.882 0l-1.775-1.775 22.627-22.627 1.775 1.775c6.253 6.253 16.384 6.243 22.627 0l204.118-204.118c6.238-6.239 6.238-16.389 0-22.627L391.431 36.686A15.895 15.895 0 0 0 380.117 32h-19.549l-32-32h51.549a48 48 0 0 1 33.941 14.059L625.94 225.941c18.746 18.745 18.746 49.137.001 67.882zM252.118 32H48c-8.822 0-16 7.178-16 16v204.118c0 4.274 1.664 8.292 4.686 11.314l211.882 211.882c6.253 6.253 16.384 6.243 22.627 0l204.118-204.118c6.238-6.239 6.238-16.389 0-22.627L263.431 36.686A15.895 15.895 0 0 0 252.118 32m0-32a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.746 18.746-49.138 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118V48C0 21.49 21.49 0 48 0h204.118zM144 124c-11.028 0-20 8.972-20 20s8.972 20 20 20 20-8.972 20-20-8.972-20-20-20m0-28c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.49-48 48-48z" class=""></path></svg><small> ${review.product__title}</small></a>`;
            }

            reviews_html += `
            <div class="bizjudge-review-container">
                <div class="bizjudge-author-row">
                    <div class="bizjudge-avatar-text"><span>${review.author.charAt(0)}</span></div>
                    <div class="bizjudge-author-name">
                        <div>
                            <span>${review.author}</span>
                            <span>${verified_badge}</span>
                        </div>
                    </div>
                    <div class="align-self-center">
                        <div class="ms-2">

                        </div>
                    </div>
                </div>

                <div class="bizjudge-rating-title-row">
                    <div class="bizjudge-review-product">${product_link_html}</div>
                    <div class="bizjudge-stars" style="--bizjudge-rating: ${parseInt(review.rating)};"
                        aria-label="The rating of this review is ${parseInt(review.rating)} out of 5."></div>
                    <h4 class="bizjudge-review-title">${review.title}</h4>
                </div>

                <div class="bizjudge-review-body">
                    <p class="mb-2">${review.text}</p>
                    <div class="bizjudge-review-footer">
                        <div class="bizjudge-review-date">
                            <small class="bizjudge-small">
                                <time datetime="${review.created_at}">${review.created_at_formatted}</time>
                            </small>
                        </div>
                    </div>
                </div>
                <hr class="bizjudge-review-divider">
            </div>`;
        });

        filters_html = `
        <div class="ratings-summary-container">
            <label for="five-stars" class="ratings-summary-row">
                <input id="five-stars" type="radio" onchange="refreshFeed()" name="ratingValue" class="bizjudge-d-none" value="5" ${filtered == '5' ? 'checked' : ''}>
                <div class="bizjudge-stars" style="--bizjudge-rating: 5;"></div>
                <div class="progress rounded-0" style="width: 140px;">
                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="5"
                        aria-valuemin="0" aria-valuemax="5" style="width: ${data.is_5_percentage}%">
                        <span class="sr-only">${data.is_5_percentage}%</span>
                    </div>
                </div>
                <div style="margin-left:2px; width: 30px;"><small>${data.is_5_percentage}%</small></div>
            </label>
            <label for="four-stars" class="ratings-summary-row">
                <input id="four-stars" type="radio" onchange="refreshFeed()" name="ratingValue" class="bizjudge-d-none" value="4" ${filtered == '4' ? 'checked' : ''}>
                <div class="bizjudge-stars" style="--bizjudge-rating: 4;"></div>
                <div class="progress rounded-0" style="width: 140px;">
                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="4"
                        aria-valuemin="0" aria-valuemax="5" style="width: ${data.is_4_percentage}%">
                        <span class="sr-only">${data.is_4_percentage}%</span>
                    </div>
                </div>
                <div style="margin-left:2px; width: 30px;"><small>${data.is_4_percentage}%</small></div>
            </label>
            <label for="three-stars" class="ratings-summary-row">
                <input id="three-stars" type="radio" onchange="refreshFeed()" name="ratingValue" class="bizjudge-d-none" value="3" ${filtered == '3' ? 'checked' : ''}>
                <div class="bizjudge-stars" style="--bizjudge-rating: 3;"></div>
                <div class="progress rounded-0" style="width: 140px;">
                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="3"
                        aria-valuemin="0" aria-valuemax="5" style="width: ${data.is_3_percentage}%">
                        <span class="sr-only">${data.is_3_percentage}%</span>
                    </div>
                </div>
                <div style="margin-left:2px; width: 30px;"><small>${data.is_3_percentage}%</small></div>
            </label>
            <label for="two-stars" class="ratings-summary-row">
                <input id="two-stars" type="radio" onchange="refreshFeed()" name="ratingValue" class="bizjudge-d-none" value="2" ${filtered == '2' ? 'checked' : ''}>
                <div class="bizjudge-stars" style="--bizjudge-rating: 2;"></div>
                <div class="progress rounded-0" style="width: 140px;">
                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="2"
                        aria-valuemin="0" aria-valuemax="5" style="width: ${data.is_2_percentage}%">
                        <span class="sr-only">${data.is_2_percentage}%</span>
                    </div>
                </div>
                <div style="margin-left:2px; width: 30px;"><small>${data.is_2_percentage}%</small></div>
            </label>
            <label for="one-star" class="ratings-summary-row">
                <input id="one-star" type="radio" onchange="refreshFeed()" name="ratingValue" class="bizjudge-d-none" value="1" ${filtered == '1' ? 'checked' : ''}>
                <div class="bizjudge-stars" style="--bizjudge-rating: 1;"></div>
                <div class="progress rounded-0" style="width: 140px;">
                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="1"
                        aria-valuemin="0" aria-valuemax="5" style="width: ${data.is_1_percentage}%">
                        <span class="sr-only">${data.is_1_percentage}%</span>
                    </div>
                </div>
                <div style="margin-left:2px; width: 30px;"><small>${data.is_1_percentage}%</small></div>
            </label>
        </div>
        <div class="sort-container">
            <div>
                <div class="bizjudge-d-inline-block">
                    <select class="bizjudge-form-control" name="sort" id="sort-reviews" onchange="refreshFeed()" aria-label="Sort Reviews">
                        <option value="-created_at" ${sort == '-created_at' ? 'selected' : ''}>Most Recent</option>
                        <option value="-trustworthiness" ${sort == '-trustworthiness' ? 'selected' : ''}>Most Trustworthy</option>
                        <option value="created_at" ${sort == 'created_at' ? 'selected' : ''}>Oldest</option>
                        <option value="-rating" ${sort == '-rating' ? 'selected' : ''}>Highest Rating</option>
                        <option value="rating" ${sort == 'rating' ? 'selected' : ''}>Lowest Rating</option>
                    </select>
                </div>
                <span data-bs-toggle="modal" class="bizjudge-filter-icon bizjudge-d-none"
                    data-bs-target="#filterModal">
                    <img src="https://storage.googleapis.com/bizjudge-bucket/static/images/filter.png"
                        alt="Filter" height="22" width="22">
                </span>
            </div>
            <div>
                <a href="${review_link}" class="bizjudge-btn">Write a review</a>
            </div>
        </div>`;

        if (product_handle) {
            review_container_footer = `
            <div class="bizjudge-reviews-container-footer">
                <h4 class="bizjudge-reviews-container-text"><a href="${company_link}" target="_blank" rel="nofollow noopener">${product__title} by ${company_name}</a> is rated ${company_rating}</h4>
            </div>`;

        } else {
            review_container_footer = `
            <div class="bizjudge-reviews-container-footer">
                <h4 class="bizjudge-reviews-container-text"><a href="${company_link}" target="_blank" rel="nofollow noopener">${company_name}</a> is rated ${company_rating}</h4>
            </div>`;
        }

        if (reviews_count == 0) {
            no_reviews_message = `${product_handle ? 'There are no reviews for this product yet. Be the first to review it!' : 'There are no reviews for this company yet. Be the first to review it!'}`;
        } else {
            no_reviews_message = `${product_handle ? 'No matches. Try changing or removing some of your filters' : 'No matches. Try changing or removing some of your filters'}`;
        }
        

        widget_html = `
        <div class="bizjudge-reviews-container">
            <div class="bizjudge-review-container-flex">
                <h2 class="bizjudge-reviews-container-title">Customer Reviews</h2>
                ${filters_html}
            </div>
            <div>${reviews_html == '' ? `<div class="bizjudge-no-reviews-container"><span class="text-muted">${no_reviews_message}</span>` : reviews_html}</div>
            ${reviews_html != '' || reviews_count != 0 ? review_container_footer : '<div class="bizjudge-d-none"></div>'}
        </div>`;
    } else if (widget_type == 'reviews-carousel-widget') {
        reviews_data.forEach(review => {
            product__title = review.product__title;
            let verified_badge = '';
            let product_link_html = '';
            author_name = 'Anonymous Customer';
            if (review.is_verified == 'true') {
                verified_badge = '<svg style="vertical-align: text-bottom;" height="16" width="16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="badge-check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M512 256c0-37.7-23.7-69.9-57.1-82.4 14.7-32.4 8.8-71.9-17.9-98.6-26.7-26.7-66.2-32.6-98.6-17.9C325.9 23.7 293.7 0 256 0s-69.9 23.7-82.4 57.1c-32.4-14.7-72-8.8-98.6 17.9-26.7 26.7-32.6 66.2-17.9 98.6C23.7 186.1 0 218.3 0 256s23.7 69.9 57.1 82.4c-14.7 32.4-8.8 72 17.9 98.6 26.6 26.6 66.1 32.7 98.6 17.9 12.5 33.3 44.7 57.1 82.4 57.1s69.9-23.7 82.4-57.1c32.6 14.8 72 8.7 98.6-17.9 26.7-26.7 32.6-66.2 17.9-98.6 33.4-12.5 57.1-44.7 57.1-82.4zm-144.8-44.25L236.16 341.74c-4.31 4.28-11.28 4.25-15.55-.06l-75.72-76.33c-4.28-4.31-4.25-11.28.06-15.56l26.03-25.82c4.31-4.28 11.28-4.25 15.56.06l42.15 42.49 97.2-96.42c4.31-4.28 11.28-4.25 15.55.06l25.82 26.03c4.28 4.32 4.26 11.29-.06 15.56z" class=""></path></svg>';
            }

            if (review.product__title != "") {
                product_link_html = `<a href="${review.product_url}" class="bizjudge-product-link" rel="noopener noreferrer">${review.product__title}</small></a>`;
            }

            reviews_html += `
            <div class="bizjudge-carousel-card-container">
                <div class="bizjudge-carousel-stars my-1 rating-lg me-1" style="--rating: ${parseInt(review.rating)};">
                    <span aria-hidden="true" hidden>The rating of this review is ${parseInt(review.rating)} out of 5.</span>
                </div>
                    <div class="bizjudge-carousel-review-card">
                        <h5 class="bizjudge-carousel-review-title">${review.title}</h5>
                        <p class="bizjudge-carousel-review-body">
                            ${review.text}
                        </p>
                        <div class="bizjudge-carousel-review-footer">
                            <div>
                                <span
                                    class="bizjudge-carousel-review-author">${review.author} ${verified_badge}</span>
                            </div>
                            <div>
                                <span class="bizjudge-carousel-product-name">${product_link_html}</span>
                            </div>
                        </div>

                    </div>
            </div>
            `;
        });

        no_reviews_message = `${product_handle ? 'No reviews for this product yet' : 'No reviews yet'}`;

        widget_html = `
        <div class="bizjudge-carousel-main-content">
            <div class="owl-carousel owl-theme">
                ${reviews_html == '' ? `<div class="text-muted" style="text-align: center">${no_reviews_message}</div>` : reviews_html}
            </div>
            <div class="owl-theme">
                <div class="owl-controls">
                    <div class="bizjudge-carousel-custom-nav owl-nav"></div>
                </div>
            </div>
        </div>`;
    }

    widget_element.innerHTML = widget_html;

    if (product__title) {
        const product_stars = document.querySelector('#bizjudge-product-title-stars');

        try {
            product_stars.innerHTML = `<div class="bizjudge-reviews-count-text-row"><div class="bizjudge-stars" style="--bizjudge-rating: ${company_rating};" aria-label="The rating of this product is ${company_rating} out of 5."></div><div class="bizjudge-reviews-count-text">${reviews_count}</div></div>`

            const jsonldScript = document.createElement('script');
            jsonldScript.setAttribute('type', 'application/ld+json');

            const structuredData = JSON.stringify(data.structured_data);

            jsonldScript.innerHTML = structuredData;
            document.head.appendChild(jsonldScript);
        } catch (err) {
            // console.error(err)
        }
    }

}

function _bizjudge_widget_callback_func(data) {
    let widget_element = document.getElementById("bizjudge-reviews-widget-badge");
    let widget_type = widget_element.getAttribute("data-widget-type");
    let company_rating = data.company_rating;
    let reviews_count = data.reviews_count;
    let company_link = data.company_link;
    let widget;

    if (widget_type == 'rating-and-reviews-vertical') {
        widget = `
        <a class="bizjudge-link" href="${company_link}" target="_blank">
            <div class="bizjudge-rating-badge-container">
                <div>
                    <svg version="1.0" height="26" class="bizjudge-widget-badge-logo" xmlns="http://www.w3.org/2000/svg" viewBox="50 190 3400 600" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,1000.000000) scale(0.100000,-0.100000)" stroke="none">
                            <path d="M4803 7475 c-106 -212 -137 -266 -155 -270 -37 -8 -502 -75 -523 -75 -55 -1 -43 -18 112 -171 87 -86 183 -178 213 -206 l54 -51 -48 -282 c-26 -156 -50 -289 -53 -296 -3 -8 0 -14 6 -14 6 0 127 61 268 136 l258 136 45 -22 c25 -12 143 -73 262 -136 120 -63 222 -114 227 -114 6 0 8 6 5 13 -3 8 -27 139 -54 293 l-49 279 210 205 c115 113 209 210 209 215 0 6 -125 28 -277 49 -152 21 -284 41 -293 43 -10 3 -68 110 -146 268 -71 145 -131 264 -134 264 -3 1 -65 -118 -137 -264z"></path>
                            <path d="M9023 7206 c-215 -52 -363 -246 -363 -475 0 -250 164 -451 402 -491 290 -49 539 94 608 350 19 70 15 224 -8 297 -50 158 -175 275 -339 318 -69 18 -227 18 -300 1z"></path>
                            <path d="M1545 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -1512 0 -1512 24 -66 c28 -79 66 -136 138 -206 144 -139 453 -280 718 -328 143 -26 538 -32 693 -11 332 47 594 161 789 345 116 110 176 190 248 336 112 225 144 385 144 715 1 327 -31 485 -144 716 -179 367 -500 606 -914 681 -122 22 -378 22 -503 0 -50 -9 -129 -30 -176 -45 l-86 -29 -3 346 c-3 337 -4 347 -27 405 -48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m1126 -1613 c191 -36 329 -183 385 -410 28 -112 26 -423 -4 -531 -58 -213 -191 -352 -370 -390 -35 -7 -102 -10 -177 -6 -119 5 -184 20 -263 61 l-32 17 0 593 0 593 68 26 c75 28 125 44 162 50 50 9 179 7 231 -3z"></path>
                            <path d="M15365 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -441 0 -440 -22 6 c-152 45 -335 62 -513 46 -702 -60 -1139 -441 -1252 -1090 -21 -121 -24 -478 -4 -595 51 -308 158 -529 351 -726 176 -179 363 -284 630 -353 177 -46 231 -51 520 -51 308 0 398 12 606 80 310 102 493 224 572 383 l37 76 0 1440 0 1441 -24 59 c-48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m-406 -1614 c24 -5 66 -19 93 -31 l48 -21 -2 -601 -3 -601 -53 -29 c-77 -40 -144 -56 -247 -56 -277 0 -468 153 -532 427 -25 110 -25 377 0 486 56 239 228 399 462 430 62 8 192 6 234 -4z"></path>
                            <path d="M17716 6069 c-356 -29 -660 -151 -870 -349 -180 -169 -306 -428 -347 -711 -17 -124 -14 -403 6 -529 70 -428 308 -757 653 -901 292 -121 729 -138 1018 -39 31 11 61 20 67 20 19 0 2 -171 -22 -227 -43 -97 -159 -180 -306 -218 -155 -40 -387 -44 -565 -10 -114 22 -293 82 -414 139 l-99 46 -42 -44 c-79 -86 -125 -203 -125 -322 0 -358 285 -540 902 -574 463 -25 843 55 1113 235 184 122 329 309 394 505 56 171 54 131 58 1250 3 682 1 1061 -6 1113 -6 45 -22 100 -38 132 -53 110 -209 238 -397 325 -286 135 -620 189 -980 159z m355 -739 c30 -5 80 -20 112 -31 l57 -21 0 -499 0 -499 -52 -30 c-29 -17 -75 -37 -103 -46 -66 -21 -237 -30 -304 -15 -166 35 -287 155 -337 332 -24 84 -30 327 -10 419 55 260 227 397 502 399 45 1 106 -3 135 -9z"></path>
                            <path d="M20835 6073 c-236 -19 -470 -87 -634 -183 -102 -59 -179 -120 -267 -212 -252 -263 -368 -613 -351 -1053 11 -263 50 -433 146 -630 187 -383 516 -621 993 -717 101 -21 141 -23 383 -23 377 0 554 30 763 130 158 76 240 173 264 313 27 157 -45 331 -172 422 l-29 21 -93 -45 c-440 -213 -1014 -188 -1230 53 -46 51 -96 136 -87 146 4 3 321 53 705 110 750 112 792 121 887 191 57 41 102 108 124 184 24 81 13 303 -20 432 -109 419 -451 727 -919 829 -138 30 -328 43 -463 32z m286 -712 c74 -28 120 -64 174 -136 37 -50 82 -142 72 -151 -5 -5 -912 -151 -916 -148 -10 10 22 133 50 193 55 120 139 196 264 239 82 29 96 31 205 27 67 -2 111 -9 151 -24z"></path>
                            <path d="M25114 6070 c-350 -34 -654 -160 -880 -364 -195 -176 -335 -446 -391 -751 -25 -133 -24 -457 1 -590 114 -611 582 -1020 1256 -1100 504 -60 906 58 1016 298 26 56 29 72 28 167 0 139 -22 196 -109 289 -90 95 -98 98 -171 68 -146 -61 -305 -97 -428 -97 -76 0 -220 27 -280 52 -186 79 -312 219 -362 403 -25 95 -30 275 -10 376 49 245 221 427 463 490 96 25 275 27 378 5 70 -15 206 -59 280 -91 l40 -17 42 47 c23 27 59 82 80 123 37 74 38 77 38 186 0 105 -2 115 -32 176 -79 161 -259 273 -503 314 -119 20 -337 27 -456 16z"></path>
                            <path d="M27670 6070 c-585 -56 -1006 -373 -1181 -889 -116 -341 -101 -806 36 -1136 177 -427 548 -706 1040 -780 118 -18 409 -20 540 -4 349 42 675 210 868 446 192 235 289 517 304 878 20 517 -161 943 -516 1211 -99 75 -288 171 -411 209 -184 57 -472 84 -680 65z m279 -741 c222 -51 351 -261 368 -600 24 -496 -192 -795 -538 -742 -277 43 -426 316 -406 742 16 329 139 539 349 595 63 17 165 20 227 5z"></path>
                            <path d="M30815 6070 c-414 -37 -854 -225 -1009 -431 -86 -114 -81 -52 -81 -1099 0 -868 1 -929 18 -985 39 -128 109 -199 232 -238 63 -20 91 -22 275 -22 152 0 229 5 299 18 51 10 98 20 102 23 5 3 9 431 9 959 l0 955 23 14 c58 37 155 68 228 73 165 12 297 -53 350 -169 l24 -53 5 -775 c6 -853 2 -807 69 -903 37 -55 93 -93 173 -120 56 -18 87 -21 273 -21 160 0 232 4 305 17 52 10 98 21 102 23 4 3 8 432 8 954 l0 949 53 29 c228 129 495 73 559 -117 9 -26 14 -244 18 -811 l5 -775 23 -50 c52 -114 112 -166 227 -202 85 -25 426 -26 565 0 52 10 98 21 103 26 4 4 6 444 4 977 -3 968 -3 969 -25 1054 -29 107 -96 246 -160 331 -138 181 -362 302 -657 355 -133 23 -409 23 -550 0 -162 -27 -372 -106 -521 -195 l-51 -31 -39 29 c-114 83 -326 166 -504 195 -121 20 -326 27 -455 16z"></path>
                            <path d="M4795 6000 c-49 -4 -130 -15 -180 -24 -49 -9 -93 -16 -98 -16 -4 0 -6 -539 -5 -1197 l3 -1198 27 -58 c35 -74 59 -104 114 -143 80 -57 143 -69 369 -68 153 1 225 5 305 20 l105 20 0 1194 0 1195 -23 56 c-46 114 -138 185 -267 207 -90 16 -249 21 -350 12z"></path>
                            <path d="M9030 6003 c-30 -2 -117 -13 -192 -24 l-138 -21 0 -1295 c0 -1435 3 -1364 -66 -1509 -40 -85 -113 -157 -228 -224 l-77 -45 7 -60 c20 -185 118 -334 268 -406 86 -41 153 -52 291 -47 198 8 335 67 470 203 87 87 157 204 201 332 73 216 68 111 72 1493 2 907 0 1261 -8 1305 -14 73 -62 167 -104 202 -43 36 -123 71 -187 82 -66 12 -234 19 -309 14z"></path>
                            <path d="M10500 6000 c-52 -4 -137 -16 -188 -25 l-93 -17 4 -867 c3 -761 6 -877 21 -960 85 -471 389 -749 933 -853 106 -21 148 -23 413 -23 264 0 308 3 424 24 386 69 689 220 774 387 54 106 53 73 50 1105 l-3 954 -23 56 c-46 114 -137 184 -272 210 -36 6 -137 12 -225 11 -149 0 -222 -7 -352 -33 l-53 -10 -2 -957 -3 -957 -85 -29 c-78 -28 -96 -30 -225 -30 -119 0 -149 3 -199 22 -81 30 -134 68 -168 122 -64 100 -62 75 -68 865 -6 805 -3 771 -79 871 -42 56 -134 109 -216 123 -79 14 -261 20 -365 11z"></path>
                            <path d="M6157 5976 c-76 -21 -127 -64 -167 -141 l-35 -68 0 -141 c0 -149 6 -181 62 -308 l26 -58 493 -2 492 -3 -464 -545 c-256 -300 -490 -582 -520 -627 -85 -126 -107 -188 -112 -314 -6 -158 27 -257 128 -378 l51 -61 952 2 c736 3 960 6 989 16 63 21 120 73 153 137 29 57 30 61 30 209 0 158 -13 222 -67 328 l-18 38 -527 2 -526 3 453 545 c499 599 521 627 567 720 105 209 74 445 -79 607 l-51 53 -891 -1 c-695 0 -902 -3 -939 -13z"></path>
                            <path d="M22924 4305 c-192 -42 -337 -191 -379 -390 -50 -238 37 -481 213 -594 95 -61 152 -75 307 -75 155 0 212 14 307 75 216 139 292 472 167 728 -41 83 -136 179 -212 215 -114 53 -272 70 -403 41z"></path>
                        </g>
                    </svg>
                </div>
                <div class="bizjudge-widget-badge-stars" style="--bizjudge-rating: ${company_rating};" aria-label="The rating of this review is ${company_rating} out of 5."></div>
                <div class="bizjudge-widget-badge-footer">
                    <span class="bizjudge-widget-badge-rating-reviews">${company_rating} rating | ${reviews_count}</span>
                </div>
            </div>
        </a>
        `;
    } else if (widget_type == 'rating-and-reviews-horizontal') {
        widget = `
        <a class="bizjudge-link" href="${company_link}" target="_blank">
            <div class="bizjudge-widget-container-horizontal">
                <div>
                    <svg version="1.0" height="26" class="bizjudge-widget-badge-logo" xmlns="http://www.w3.org/2000/svg" viewBox="50 190 3400 600" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,1000.000000) scale(0.100000,-0.100000)" stroke="none">
                            <path d="M4803 7475 c-106 -212 -137 -266 -155 -270 -37 -8 -502 -75 -523 -75 -55 -1 -43 -18 112 -171 87 -86 183 -178 213 -206 l54 -51 -48 -282 c-26 -156 -50 -289 -53 -296 -3 -8 0 -14 6 -14 6 0 127 61 268 136 l258 136 45 -22 c25 -12 143 -73 262 -136 120 -63 222 -114 227 -114 6 0 8 6 5 13 -3 8 -27 139 -54 293 l-49 279 210 205 c115 113 209 210 209 215 0 6 -125 28 -277 49 -152 21 -284 41 -293 43 -10 3 -68 110 -146 268 -71 145 -131 264 -134 264 -3 1 -65 -118 -137 -264z"></path>
                            <path d="M9023 7206 c-215 -52 -363 -246 -363 -475 0 -250 164 -451 402 -491 290 -49 539 94 608 350 19 70 15 224 -8 297 -50 158 -175 275 -339 318 -69 18 -227 18 -300 1z"></path>
                            <path d="M1545 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -1512 0 -1512 24 -66 c28 -79 66 -136 138 -206 144 -139 453 -280 718 -328 143 -26 538 -32 693 -11 332 47 594 161 789 345 116 110 176 190 248 336 112 225 144 385 144 715 1 327 -31 485 -144 716 -179 367 -500 606 -914 681 -122 22 -378 22 -503 0 -50 -9 -129 -30 -176 -45 l-86 -29 -3 346 c-3 337 -4 347 -27 405 -48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m1126 -1613 c191 -36 329 -183 385 -410 28 -112 26 -423 -4 -531 -58 -213 -191 -352 -370 -390 -35 -7 -102 -10 -177 -6 -119 5 -184 20 -263 61 l-32 17 0 593 0 593 68 26 c75 28 125 44 162 50 50 9 179 7 231 -3z"></path>
                            <path d="M15365 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -441 0 -440 -22 6 c-152 45 -335 62 -513 46 -702 -60 -1139 -441 -1252 -1090 -21 -121 -24 -478 -4 -595 51 -308 158 -529 351 -726 176 -179 363 -284 630 -353 177 -46 231 -51 520 -51 308 0 398 12 606 80 310 102 493 224 572 383 l37 76 0 1440 0 1441 -24 59 c-48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m-406 -1614 c24 -5 66 -19 93 -31 l48 -21 -2 -601 -3 -601 -53 -29 c-77 -40 -144 -56 -247 -56 -277 0 -468 153 -532 427 -25 110 -25 377 0 486 56 239 228 399 462 430 62 8 192 6 234 -4z"></path>
                            <path d="M17716 6069 c-356 -29 -660 -151 -870 -349 -180 -169 -306 -428 -347 -711 -17 -124 -14 -403 6 -529 70 -428 308 -757 653 -901 292 -121 729 -138 1018 -39 31 11 61 20 67 20 19 0 2 -171 -22 -227 -43 -97 -159 -180 -306 -218 -155 -40 -387 -44 -565 -10 -114 22 -293 82 -414 139 l-99 46 -42 -44 c-79 -86 -125 -203 -125 -322 0 -358 285 -540 902 -574 463 -25 843 55 1113 235 184 122 329 309 394 505 56 171 54 131 58 1250 3 682 1 1061 -6 1113 -6 45 -22 100 -38 132 -53 110 -209 238 -397 325 -286 135 -620 189 -980 159z m355 -739 c30 -5 80 -20 112 -31 l57 -21 0 -499 0 -499 -52 -30 c-29 -17 -75 -37 -103 -46 -66 -21 -237 -30 -304 -15 -166 35 -287 155 -337 332 -24 84 -30 327 -10 419 55 260 227 397 502 399 45 1 106 -3 135 -9z"></path>
                            <path d="M20835 6073 c-236 -19 -470 -87 -634 -183 -102 -59 -179 -120 -267 -212 -252 -263 -368 -613 -351 -1053 11 -263 50 -433 146 -630 187 -383 516 -621 993 -717 101 -21 141 -23 383 -23 377 0 554 30 763 130 158 76 240 173 264 313 27 157 -45 331 -172 422 l-29 21 -93 -45 c-440 -213 -1014 -188 -1230 53 -46 51 -96 136 -87 146 4 3 321 53 705 110 750 112 792 121 887 191 57 41 102 108 124 184 24 81 13 303 -20 432 -109 419 -451 727 -919 829 -138 30 -328 43 -463 32z m286 -712 c74 -28 120 -64 174 -136 37 -50 82 -142 72 -151 -5 -5 -912 -151 -916 -148 -10 10 22 133 50 193 55 120 139 196 264 239 82 29 96 31 205 27 67 -2 111 -9 151 -24z"></path>
                            <path d="M25114 6070 c-350 -34 -654 -160 -880 -364 -195 -176 -335 -446 -391 -751 -25 -133 -24 -457 1 -590 114 -611 582 -1020 1256 -1100 504 -60 906 58 1016 298 26 56 29 72 28 167 0 139 -22 196 -109 289 -90 95 -98 98 -171 68 -146 -61 -305 -97 -428 -97 -76 0 -220 27 -280 52 -186 79 -312 219 -362 403 -25 95 -30 275 -10 376 49 245 221 427 463 490 96 25 275 27 378 5 70 -15 206 -59 280 -91 l40 -17 42 47 c23 27 59 82 80 123 37 74 38 77 38 186 0 105 -2 115 -32 176 -79 161 -259 273 -503 314 -119 20 -337 27 -456 16z"></path>
                            <path d="M27670 6070 c-585 -56 -1006 -373 -1181 -889 -116 -341 -101 -806 36 -1136 177 -427 548 -706 1040 -780 118 -18 409 -20 540 -4 349 42 675 210 868 446 192 235 289 517 304 878 20 517 -161 943 -516 1211 -99 75 -288 171 -411 209 -184 57 -472 84 -680 65z m279 -741 c222 -51 351 -261 368 -600 24 -496 -192 -795 -538 -742 -277 43 -426 316 -406 742 16 329 139 539 349 595 63 17 165 20 227 5z"></path>
                            <path d="M30815 6070 c-414 -37 -854 -225 -1009 -431 -86 -114 -81 -52 -81 -1099 0 -868 1 -929 18 -985 39 -128 109 -199 232 -238 63 -20 91 -22 275 -22 152 0 229 5 299 18 51 10 98 20 102 23 5 3 9 431 9 959 l0 955 23 14 c58 37 155 68 228 73 165 12 297 -53 350 -169 l24 -53 5 -775 c6 -853 2 -807 69 -903 37 -55 93 -93 173 -120 56 -18 87 -21 273 -21 160 0 232 4 305 17 52 10 98 21 102 23 4 3 8 432 8 954 l0 949 53 29 c228 129 495 73 559 -117 9 -26 14 -244 18 -811 l5 -775 23 -50 c52 -114 112 -166 227 -202 85 -25 426 -26 565 0 52 10 98 21 103 26 4 4 6 444 4 977 -3 968 -3 969 -25 1054 -29 107 -96 246 -160 331 -138 181 -362 302 -657 355 -133 23 -409 23 -550 0 -162 -27 -372 -106 -521 -195 l-51 -31 -39 29 c-114 83 -326 166 -504 195 -121 20 -326 27 -455 16z"></path>
                            <path d="M4795 6000 c-49 -4 -130 -15 -180 -24 -49 -9 -93 -16 -98 -16 -4 0 -6 -539 -5 -1197 l3 -1198 27 -58 c35 -74 59 -104 114 -143 80 -57 143 -69 369 -68 153 1 225 5 305 20 l105 20 0 1194 0 1195 -23 56 c-46 114 -138 185 -267 207 -90 16 -249 21 -350 12z"></path>
                            <path d="M9030 6003 c-30 -2 -117 -13 -192 -24 l-138 -21 0 -1295 c0 -1435 3 -1364 -66 -1509 -40 -85 -113 -157 -228 -224 l-77 -45 7 -60 c20 -185 118 -334 268 -406 86 -41 153 -52 291 -47 198 8 335 67 470 203 87 87 157 204 201 332 73 216 68 111 72 1493 2 907 0 1261 -8 1305 -14 73 -62 167 -104 202 -43 36 -123 71 -187 82 -66 12 -234 19 -309 14z"></path>
                            <path d="M10500 6000 c-52 -4 -137 -16 -188 -25 l-93 -17 4 -867 c3 -761 6 -877 21 -960 85 -471 389 -749 933 -853 106 -21 148 -23 413 -23 264 0 308 3 424 24 386 69 689 220 774 387 54 106 53 73 50 1105 l-3 954 -23 56 c-46 114 -137 184 -272 210 -36 6 -137 12 -225 11 -149 0 -222 -7 -352 -33 l-53 -10 -2 -957 -3 -957 -85 -29 c-78 -28 -96 -30 -225 -30 -119 0 -149 3 -199 22 -81 30 -134 68 -168 122 -64 100 -62 75 -68 865 -6 805 -3 771 -79 871 -42 56 -134 109 -216 123 -79 14 -261 20 -365 11z"></path>
                            <path d="M6157 5976 c-76 -21 -127 -64 -167 -141 l-35 -68 0 -141 c0 -149 6 -181 62 -308 l26 -58 493 -2 492 -3 -464 -545 c-256 -300 -490 -582 -520 -627 -85 -126 -107 -188 -112 -314 -6 -158 27 -257 128 -378 l51 -61 952 2 c736 3 960 6 989 16 63 21 120 73 153 137 29 57 30 61 30 209 0 158 -13 222 -67 328 l-18 38 -527 2 -526 3 453 545 c499 599 521 627 567 720 105 209 74 445 -79 607 l-51 53 -891 -1 c-695 0 -902 -3 -939 -13z"></path>
                            <path d="M22924 4305 c-192 -42 -337 -191 -379 -390 -50 -238 37 -481 213 -594 95 -61 152 -75 307 -75 155 0 212 14 307 75 216 139 292 472 167 728 -41 83 -136 179 -212 215 -114 53 -272 70 -403 41z"></path>
                        </g>
                    </svg>
                </div>
                <div class="bizjudge-widget-badge-stars" style="--bizjudge-rating: ${company_rating};" aria-label="The rating of this review is ${company_rating} out of 5."></div>
                <div class="bizjudge-widget-badge-footer">
                    <span class="bizjudge-widget-badge-rating-reviews">${company_rating} rating | ${reviews_count}</span>
                </div>
            </div>
        </a>`;
    } else if (widget_type == 'reviews-count') {
        widget = `
        <a class="bizjudge-link" href="${company_link}" target="_blank">
            <div class="bizjudge-widget-container-horizontal">
                <div>
                    <span class="bizjudge-reviews-badge-text">See our ${reviews_count} reviews on </span>
                </div>
                <div>
                    <svg version="1.0" height="26" class="bizjudge-widget-badge-logo" xmlns="http://www.w3.org/2000/svg" viewBox="50 190 3400 600" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,1000.000000) scale(0.100000,-0.100000)" stroke="none">
                            <path d="M4803 7475 c-106 -212 -137 -266 -155 -270 -37 -8 -502 -75 -523 -75 -55 -1 -43 -18 112 -171 87 -86 183 -178 213 -206 l54 -51 -48 -282 c-26 -156 -50 -289 -53 -296 -3 -8 0 -14 6 -14 6 0 127 61 268 136 l258 136 45 -22 c25 -12 143 -73 262 -136 120 -63 222 -114 227 -114 6 0 8 6 5 13 -3 8 -27 139 -54 293 l-49 279 210 205 c115 113 209 210 209 215 0 6 -125 28 -277 49 -152 21 -284 41 -293 43 -10 3 -68 110 -146 268 -71 145 -131 264 -134 264 -3 1 -65 -118 -137 -264z"></path>
                            <path d="M9023 7206 c-215 -52 -363 -246 -363 -475 0 -250 164 -451 402 -491 290 -49 539 94 608 350 19 70 15 224 -8 297 -50 158 -175 275 -339 318 -69 18 -227 18 -300 1z"></path>
                            <path d="M1545 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -1512 0 -1512 24 -66 c28 -79 66 -136 138 -206 144 -139 453 -280 718 -328 143 -26 538 -32 693 -11 332 47 594 161 789 345 116 110 176 190 248 336 112 225 144 385 144 715 1 327 -31 485 -144 716 -179 367 -500 606 -914 681 -122 22 -378 22 -503 0 -50 -9 -129 -30 -176 -45 l-86 -29 -3 346 c-3 337 -4 347 -27 405 -48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m1126 -1613 c191 -36 329 -183 385 -410 28 -112 26 -423 -4 -531 -58 -213 -191 -352 -370 -390 -35 -7 -102 -10 -177 -6 -119 5 -184 20 -263 61 l-32 17 0 593 0 593 68 26 c75 28 125 44 162 50 50 9 179 7 231 -3z"></path>
                            <path d="M15365 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -441 0 -440 -22 6 c-152 45 -335 62 -513 46 -702 -60 -1139 -441 -1252 -1090 -21 -121 -24 -478 -4 -595 51 -308 158 -529 351 -726 176 -179 363 -284 630 -353 177 -46 231 -51 520 -51 308 0 398 12 606 80 310 102 493 224 572 383 l37 76 0 1440 0 1441 -24 59 c-48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m-406 -1614 c24 -5 66 -19 93 -31 l48 -21 -2 -601 -3 -601 -53 -29 c-77 -40 -144 -56 -247 -56 -277 0 -468 153 -532 427 -25 110 -25 377 0 486 56 239 228 399 462 430 62 8 192 6 234 -4z"></path>
                            <path d="M17716 6069 c-356 -29 -660 -151 -870 -349 -180 -169 -306 -428 -347 -711 -17 -124 -14 -403 6 -529 70 -428 308 -757 653 -901 292 -121 729 -138 1018 -39 31 11 61 20 67 20 19 0 2 -171 -22 -227 -43 -97 -159 -180 -306 -218 -155 -40 -387 -44 -565 -10 -114 22 -293 82 -414 139 l-99 46 -42 -44 c-79 -86 -125 -203 -125 -322 0 -358 285 -540 902 -574 463 -25 843 55 1113 235 184 122 329 309 394 505 56 171 54 131 58 1250 3 682 1 1061 -6 1113 -6 45 -22 100 -38 132 -53 110 -209 238 -397 325 -286 135 -620 189 -980 159z m355 -739 c30 -5 80 -20 112 -31 l57 -21 0 -499 0 -499 -52 -30 c-29 -17 -75 -37 -103 -46 -66 -21 -237 -30 -304 -15 -166 35 -287 155 -337 332 -24 84 -30 327 -10 419 55 260 227 397 502 399 45 1 106 -3 135 -9z"></path>
                            <path d="M20835 6073 c-236 -19 -470 -87 -634 -183 -102 -59 -179 -120 -267 -212 -252 -263 -368 -613 -351 -1053 11 -263 50 -433 146 -630 187 -383 516 -621 993 -717 101 -21 141 -23 383 -23 377 0 554 30 763 130 158 76 240 173 264 313 27 157 -45 331 -172 422 l-29 21 -93 -45 c-440 -213 -1014 -188 -1230 53 -46 51 -96 136 -87 146 4 3 321 53 705 110 750 112 792 121 887 191 57 41 102 108 124 184 24 81 13 303 -20 432 -109 419 -451 727 -919 829 -138 30 -328 43 -463 32z m286 -712 c74 -28 120 -64 174 -136 37 -50 82 -142 72 -151 -5 -5 -912 -151 -916 -148 -10 10 22 133 50 193 55 120 139 196 264 239 82 29 96 31 205 27 67 -2 111 -9 151 -24z"></path>
                            <path d="M25114 6070 c-350 -34 -654 -160 -880 -364 -195 -176 -335 -446 -391 -751 -25 -133 -24 -457 1 -590 114 -611 582 -1020 1256 -1100 504 -60 906 58 1016 298 26 56 29 72 28 167 0 139 -22 196 -109 289 -90 95 -98 98 -171 68 -146 -61 -305 -97 -428 -97 -76 0 -220 27 -280 52 -186 79 -312 219 -362 403 -25 95 -30 275 -10 376 49 245 221 427 463 490 96 25 275 27 378 5 70 -15 206 -59 280 -91 l40 -17 42 47 c23 27 59 82 80 123 37 74 38 77 38 186 0 105 -2 115 -32 176 -79 161 -259 273 -503 314 -119 20 -337 27 -456 16z"></path>
                            <path d="M27670 6070 c-585 -56 -1006 -373 -1181 -889 -116 -341 -101 -806 36 -1136 177 -427 548 -706 1040 -780 118 -18 409 -20 540 -4 349 42 675 210 868 446 192 235 289 517 304 878 20 517 -161 943 -516 1211 -99 75 -288 171 -411 209 -184 57 -472 84 -680 65z m279 -741 c222 -51 351 -261 368 -600 24 -496 -192 -795 -538 -742 -277 43 -426 316 -406 742 16 329 139 539 349 595 63 17 165 20 227 5z"></path>
                            <path d="M30815 6070 c-414 -37 -854 -225 -1009 -431 -86 -114 -81 -52 -81 -1099 0 -868 1 -929 18 -985 39 -128 109 -199 232 -238 63 -20 91 -22 275 -22 152 0 229 5 299 18 51 10 98 20 102 23 5 3 9 431 9 959 l0 955 23 14 c58 37 155 68 228 73 165 12 297 -53 350 -169 l24 -53 5 -775 c6 -853 2 -807 69 -903 37 -55 93 -93 173 -120 56 -18 87 -21 273 -21 160 0 232 4 305 17 52 10 98 21 102 23 4 3 8 432 8 954 l0 949 53 29 c228 129 495 73 559 -117 9 -26 14 -244 18 -811 l5 -775 23 -50 c52 -114 112 -166 227 -202 85 -25 426 -26 565 0 52 10 98 21 103 26 4 4 6 444 4 977 -3 968 -3 969 -25 1054 -29 107 -96 246 -160 331 -138 181 -362 302 -657 355 -133 23 -409 23 -550 0 -162 -27 -372 -106 -521 -195 l-51 -31 -39 29 c-114 83 -326 166 -504 195 -121 20 -326 27 -455 16z"></path>
                            <path d="M4795 6000 c-49 -4 -130 -15 -180 -24 -49 -9 -93 -16 -98 -16 -4 0 -6 -539 -5 -1197 l3 -1198 27 -58 c35 -74 59 -104 114 -143 80 -57 143 -69 369 -68 153 1 225 5 305 20 l105 20 0 1194 0 1195 -23 56 c-46 114 -138 185 -267 207 -90 16 -249 21 -350 12z"></path>
                            <path d="M9030 6003 c-30 -2 -117 -13 -192 -24 l-138 -21 0 -1295 c0 -1435 3 -1364 -66 -1509 -40 -85 -113 -157 -228 -224 l-77 -45 7 -60 c20 -185 118 -334 268 -406 86 -41 153 -52 291 -47 198 8 335 67 470 203 87 87 157 204 201 332 73 216 68 111 72 1493 2 907 0 1261 -8 1305 -14 73 -62 167 -104 202 -43 36 -123 71 -187 82 -66 12 -234 19 -309 14z"></path>
                            <path d="M10500 6000 c-52 -4 -137 -16 -188 -25 l-93 -17 4 -867 c3 -761 6 -877 21 -960 85 -471 389 -749 933 -853 106 -21 148 -23 413 -23 264 0 308 3 424 24 386 69 689 220 774 387 54 106 53 73 50 1105 l-3 954 -23 56 c-46 114 -137 184 -272 210 -36 6 -137 12 -225 11 -149 0 -222 -7 -352 -33 l-53 -10 -2 -957 -3 -957 -85 -29 c-78 -28 -96 -30 -225 -30 -119 0 -149 3 -199 22 -81 30 -134 68 -168 122 -64 100 -62 75 -68 865 -6 805 -3 771 -79 871 -42 56 -134 109 -216 123 -79 14 -261 20 -365 11z"></path>
                            <path d="M6157 5976 c-76 -21 -127 -64 -167 -141 l-35 -68 0 -141 c0 -149 6 -181 62 -308 l26 -58 493 -2 492 -3 -464 -545 c-256 -300 -490 -582 -520 -627 -85 -126 -107 -188 -112 -314 -6 -158 27 -257 128 -378 l51 -61 952 2 c736 3 960 6 989 16 63 21 120 73 153 137 29 57 30 61 30 209 0 158 -13 222 -67 328 l-18 38 -527 2 -526 3 453 545 c499 599 521 627 567 720 105 209 74 445 -79 607 l-51 53 -891 -1 c-695 0 -902 -3 -939 -13z"></path>
                            <path d="M22924 4305 c-192 -42 -337 -191 -379 -390 -50 -238 37 -481 213 -594 95 -61 152 -75 307 -75 155 0 212 14 307 75 216 139 292 472 167 728 -41 83 -136 179 -212 215 -114 53 -272 70 -403 41z"></path>
                        </g>
                    </svg>
                </div>
            </div>
        </a>`;
    } else if (widget_type == 'review-collector') {
        widget = `
        <a class="bizjudge-link" href="${company_link}" target="_blank">
            <div class="bizjudge-widget-container-horizontal">
                <div>
                    <span class="bizjudge-reviews-badge-text">Review us on </span>
                </div>
                <div>
                    <svg version="1.0" height="26" class="bizjudge-widget-badge-logo" xmlns="http://www.w3.org/2000/svg" viewBox="50 190 3400 600" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,1000.000000) scale(0.100000,-0.100000)" stroke="none">
                            <path d="M4803 7475 c-106 -212 -137 -266 -155 -270 -37 -8 -502 -75 -523 -75 -55 -1 -43 -18 112 -171 87 -86 183 -178 213 -206 l54 -51 -48 -282 c-26 -156 -50 -289 -53 -296 -3 -8 0 -14 6 -14 6 0 127 61 268 136 l258 136 45 -22 c25 -12 143 -73 262 -136 120 -63 222 -114 227 -114 6 0 8 6 5 13 -3 8 -27 139 -54 293 l-49 279 210 205 c115 113 209 210 209 215 0 6 -125 28 -277 49 -152 21 -284 41 -293 43 -10 3 -68 110 -146 268 -71 145 -131 264 -134 264 -3 1 -65 -118 -137 -264z"></path>
                            <path d="M9023 7206 c-215 -52 -363 -246 -363 -475 0 -250 164 -451 402 -491 290 -49 539 94 608 350 19 70 15 224 -8 297 -50 158 -175 275 -339 318 -69 18 -227 18 -300 1z"></path>
                            <path d="M1545 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -1512 0 -1512 24 -66 c28 -79 66 -136 138 -206 144 -139 453 -280 718 -328 143 -26 538 -32 693 -11 332 47 594 161 789 345 116 110 176 190 248 336 112 225 144 385 144 715 1 327 -31 485 -144 716 -179 367 -500 606 -914 681 -122 22 -378 22 -503 0 -50 -9 -129 -30 -176 -45 l-86 -29 -3 346 c-3 337 -4 347 -27 405 -48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m1126 -1613 c191 -36 329 -183 385 -410 28 -112 26 -423 -4 -531 -58 -213 -191 -352 -370 -390 -35 -7 -102 -10 -177 -6 -119 5 -184 20 -263 61 l-32 17 0 593 0 593 68 26 c75 28 125 44 162 50 50 9 179 7 231 -3z"></path>
                            <path d="M15365 6943 c-52 -6 -158 -23 -212 -34 l-53 -10 0 -441 0 -440 -22 6 c-152 45 -335 62 -513 46 -702 -60 -1139 -441 -1252 -1090 -21 -121 -24 -478 -4 -595 51 -308 158 -529 351 -726 176 -179 363 -284 630 -353 177 -46 231 -51 520 -51 308 0 398 12 606 80 310 102 493 224 572 383 l37 76 0 1440 0 1441 -24 59 c-48 119 -142 183 -305 205 -72 10 -263 13 -331 4z m-406 -1614 c24 -5 66 -19 93 -31 l48 -21 -2 -601 -3 -601 -53 -29 c-77 -40 -144 -56 -247 -56 -277 0 -468 153 -532 427 -25 110 -25 377 0 486 56 239 228 399 462 430 62 8 192 6 234 -4z"></path>
                            <path d="M17716 6069 c-356 -29 -660 -151 -870 -349 -180 -169 -306 -428 -347 -711 -17 -124 -14 -403 6 -529 70 -428 308 -757 653 -901 292 -121 729 -138 1018 -39 31 11 61 20 67 20 19 0 2 -171 -22 -227 -43 -97 -159 -180 -306 -218 -155 -40 -387 -44 -565 -10 -114 22 -293 82 -414 139 l-99 46 -42 -44 c-79 -86 -125 -203 -125 -322 0 -358 285 -540 902 -574 463 -25 843 55 1113 235 184 122 329 309 394 505 56 171 54 131 58 1250 3 682 1 1061 -6 1113 -6 45 -22 100 -38 132 -53 110 -209 238 -397 325 -286 135 -620 189 -980 159z m355 -739 c30 -5 80 -20 112 -31 l57 -21 0 -499 0 -499 -52 -30 c-29 -17 -75 -37 -103 -46 -66 -21 -237 -30 -304 -15 -166 35 -287 155 -337 332 -24 84 -30 327 -10 419 55 260 227 397 502 399 45 1 106 -3 135 -9z"></path>
                            <path d="M20835 6073 c-236 -19 -470 -87 -634 -183 -102 -59 -179 -120 -267 -212 -252 -263 -368 -613 -351 -1053 11 -263 50 -433 146 -630 187 -383 516 -621 993 -717 101 -21 141 -23 383 -23 377 0 554 30 763 130 158 76 240 173 264 313 27 157 -45 331 -172 422 l-29 21 -93 -45 c-440 -213 -1014 -188 -1230 53 -46 51 -96 136 -87 146 4 3 321 53 705 110 750 112 792 121 887 191 57 41 102 108 124 184 24 81 13 303 -20 432 -109 419 -451 727 -919 829 -138 30 -328 43 -463 32z m286 -712 c74 -28 120 -64 174 -136 37 -50 82 -142 72 -151 -5 -5 -912 -151 -916 -148 -10 10 22 133 50 193 55 120 139 196 264 239 82 29 96 31 205 27 67 -2 111 -9 151 -24z"></path>
                            <path d="M25114 6070 c-350 -34 -654 -160 -880 -364 -195 -176 -335 -446 -391 -751 -25 -133 -24 -457 1 -590 114 -611 582 -1020 1256 -1100 504 -60 906 58 1016 298 26 56 29 72 28 167 0 139 -22 196 -109 289 -90 95 -98 98 -171 68 -146 -61 -305 -97 -428 -97 -76 0 -220 27 -280 52 -186 79 -312 219 -362 403 -25 95 -30 275 -10 376 49 245 221 427 463 490 96 25 275 27 378 5 70 -15 206 -59 280 -91 l40 -17 42 47 c23 27 59 82 80 123 37 74 38 77 38 186 0 105 -2 115 -32 176 -79 161 -259 273 -503 314 -119 20 -337 27 -456 16z"></path>
                            <path d="M27670 6070 c-585 -56 -1006 -373 -1181 -889 -116 -341 -101 -806 36 -1136 177 -427 548 -706 1040 -780 118 -18 409 -20 540 -4 349 42 675 210 868 446 192 235 289 517 304 878 20 517 -161 943 -516 1211 -99 75 -288 171 -411 209 -184 57 -472 84 -680 65z m279 -741 c222 -51 351 -261 368 -600 24 -496 -192 -795 -538 -742 -277 43 -426 316 -406 742 16 329 139 539 349 595 63 17 165 20 227 5z"></path>
                            <path d="M30815 6070 c-414 -37 -854 -225 -1009 -431 -86 -114 -81 -52 -81 -1099 0 -868 1 -929 18 -985 39 -128 109 -199 232 -238 63 -20 91 -22 275 -22 152 0 229 5 299 18 51 10 98 20 102 23 5 3 9 431 9 959 l0 955 23 14 c58 37 155 68 228 73 165 12 297 -53 350 -169 l24 -53 5 -775 c6 -853 2 -807 69 -903 37 -55 93 -93 173 -120 56 -18 87 -21 273 -21 160 0 232 4 305 17 52 10 98 21 102 23 4 3 8 432 8 954 l0 949 53 29 c228 129 495 73 559 -117 9 -26 14 -244 18 -811 l5 -775 23 -50 c52 -114 112 -166 227 -202 85 -25 426 -26 565 0 52 10 98 21 103 26 4 4 6 444 4 977 -3 968 -3 969 -25 1054 -29 107 -96 246 -160 331 -138 181 -362 302 -657 355 -133 23 -409 23 -550 0 -162 -27 -372 -106 -521 -195 l-51 -31 -39 29 c-114 83 -326 166 -504 195 -121 20 -326 27 -455 16z"></path>
                            <path d="M4795 6000 c-49 -4 -130 -15 -180 -24 -49 -9 -93 -16 -98 -16 -4 0 -6 -539 -5 -1197 l3 -1198 27 -58 c35 -74 59 -104 114 -143 80 -57 143 -69 369 -68 153 1 225 5 305 20 l105 20 0 1194 0 1195 -23 56 c-46 114 -138 185 -267 207 -90 16 -249 21 -350 12z"></path>
                            <path d="M9030 6003 c-30 -2 -117 -13 -192 -24 l-138 -21 0 -1295 c0 -1435 3 -1364 -66 -1509 -40 -85 -113 -157 -228 -224 l-77 -45 7 -60 c20 -185 118 -334 268 -406 86 -41 153 -52 291 -47 198 8 335 67 470 203 87 87 157 204 201 332 73 216 68 111 72 1493 2 907 0 1261 -8 1305 -14 73 -62 167 -104 202 -43 36 -123 71 -187 82 -66 12 -234 19 -309 14z"></path>
                            <path d="M10500 6000 c-52 -4 -137 -16 -188 -25 l-93 -17 4 -867 c3 -761 6 -877 21 -960 85 -471 389 -749 933 -853 106 -21 148 -23 413 -23 264 0 308 3 424 24 386 69 689 220 774 387 54 106 53 73 50 1105 l-3 954 -23 56 c-46 114 -137 184 -272 210 -36 6 -137 12 -225 11 -149 0 -222 -7 -352 -33 l-53 -10 -2 -957 -3 -957 -85 -29 c-78 -28 -96 -30 -225 -30 -119 0 -149 3 -199 22 -81 30 -134 68 -168 122 -64 100 -62 75 -68 865 -6 805 -3 771 -79 871 -42 56 -134 109 -216 123 -79 14 -261 20 -365 11z"></path>
                            <path d="M6157 5976 c-76 -21 -127 -64 -167 -141 l-35 -68 0 -141 c0 -149 6 -181 62 -308 l26 -58 493 -2 492 -3 -464 -545 c-256 -300 -490 -582 -520 -627 -85 -126 -107 -188 -112 -314 -6 -158 27 -257 128 -378 l51 -61 952 2 c736 3 960 6 989 16 63 21 120 73 153 137 29 57 30 61 30 209 0 158 -13 222 -67 328 l-18 38 -527 2 -526 3 453 545 c499 599 521 627 567 720 105 209 74 445 -79 607 l-51 53 -891 -1 c-695 0 -902 -3 -939 -13z"></path>
                            <path d="M22924 4305 c-192 -42 -337 -191 -379 -390 -50 -238 37 -481 213 -594 95 -61 152 -75 307 -75 155 0 212 14 307 75 216 139 292 472 167 728 -41 83 -136 179 -212 215 -114 53 -272 70 -403 41z"></path>
                        </g>
                    </svg>
                </div>
            </div>
        </a>`;
    }

    widget_element.innerHTML = widget;
}

function _collections_widget_callback_func(data) {
    let rating_containers = document.querySelectorAll(".bizjudge-collection-product-rating");
    rating_containers.forEach(element => {
        let product_handle = element.getAttribute("data-product-handle");
        let reviews_count = data[product_handle]['count'];
        let average_rating = data[product_handle]['average_rating'];

        element.innerHTML = `<div class="bizjudge-reviews-count-text-row"><div class="bizjudge-stars" style="--bizjudge-rating: ${average_rating};" aria-label="The rating of this product is ${average_rating} out of 5."></div><div class="bizjudge-reviews-count-text">${reviews_count}</div></div>`
    })
}

function initWidget(sort, filtered=undefined) {
    const reviews_widgets = ["standard-reviews-widget", "reviews-carousel-widget"]
    const badge_widgets = ["rating-and-reviews-vertical", "rating-and-reviews-horizontal", "reviews-count", "review-collector"]
    const collection_page_widgets = document.querySelectorAll('.bizjudge-collection-product-rating')
    // get all widgets on the page (max 1 reviews widget and 1 badge widget)
    const widget_elements = document.querySelectorAll('#bizjudge-reviews-widget, #bizjudge-reviews-widget-badge')
    widget_elements.forEach(widget_element => {
        let business_id = widget_element.getAttribute("data-business-id");
        let widget_type = widget_element.getAttribute("data-widget-type");
        let product_id = widget_element.getAttribute("data-product-handle") ? widget_element.getAttribute("data-product-handle") : null;
        let per_page = widget_element.getAttribute("data-reviews-per-page") ? widget_element.getAttribute("data-reviews-per-page") : null;
        sort = sort ? sort : widget_element.getAttribute("data-reviews-order");

        if (widget_type == 'reviews-carousel-widget') {
            const owl_carousel_script = document.createElement('script');
            owl_carousel_script.innerHTML = `
            function loadOwlCarousel () {
                $('.bizjudge-carousel-main-content .owl-carousel').owlCarousel({
                    loop: true,
                    stagePadding: 20,
                    margin: 30,
                    responsiveClass: true,
                    dots: false,
                    nav: true,
                    navText: [
                        '<svg aria-hidden="true" focusable="false" height="30" width="30" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512" class="svg-inline--fa fa-angle-left fa-w-8 fa-3x"><path fill="#000000" d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z" class=""></path></svg>',
                        '<svg aria-hidden="true" focusable="false" height="30" width="30" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512" class="svg-inline--fa fa-angle-right fa-w-8 fa-3x"><path fill="#000000" d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z" class=""></path></svg>'
                    ],
                    navContainer: '.bizjudge-carousel-main-content .bizjudge-carousel-custom-nav',
                    responsive: {
                        0: {items: 1},
                        930: {items: 2},
                        1300: {items: 3},
                        1850: {items: 4},
                        2200: {items: 5}
                    }
                });
            };`;
            document.getElementsByTagName('body')[0].appendChild(owl_carousel_script);

            const script = document.createElement('script');
            script.src = "https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.js";
            document.getElementsByTagName('body')[0].appendChild(script);

            const link = document.createElement('link');
            link.href = "https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css";
            link.rel = 'stylesheet';
            document.getElementsByTagName('head')[0].appendChild(link);

            setTimeout(() => {
                loadOwlCarousel();
            }, 1500);
        }

        const scriptElement = document.createElement("script");
        let url;

        if (reviews_widgets.includes(widget_type)) {
            // TODO - change this to bizjudge.com
            // url = `http://127.0.0.1:8000/company/review-widget/?company=${business_id}&productHandle=${product_id}&perPage=${per_page}&sort=${sort ? sort : "-created_at"}&filtered=${filtered}&callback=_bizjudge_reviews_callback_func`;
            url = `https://bizjudge.com/company/review-widget/?company=${business_id}&productHandle=${product_id}&perPage=${per_page}&sort=${sort ? sort : "-created_at"}&filtered=${filtered}&callback=_bizjudge_reviews_callback_func`;

        } else if (badge_widgets.includes(widget_type)) {
            // url = `http://127.0.0.1:8000/company/widget/?company=${business_id}&callback=_bizjudge_widget_callback_func`;
            url = `https://bizjudge.com/company/widget/?company=${business_id}&callback=_bizjudge_widget_callback_func`;
        }


        // Set the src and id attributes of the script element
        scriptElement.setAttribute("src", url);
        scriptElement.setAttribute("id", `bizjudge-${widget_type}-reviews-jsonp`);
        const oldScriptElement = document.getElementById("id", `bizjudge-${widget_type}-reviews-jsonp`);

        // Get the head element
        const head = document.getElementsByTagName("head")[0];
        if (oldScriptElement == null) {
            head.appendChild(scriptElement);
        }
        else {
            head.replaceChild(scriptElement, oldScriptElement);
        }
    })

    if (collection_page_widgets.length) {
        url = `https://bizjudge.com/company/collections-widget/?company=${business_id}&callback=_collections_widget_callback_func`;

        // Set the src and id attributes of the script element
        scriptElement.setAttribute("src", url);
        scriptElement.setAttribute("id", `bizjudge-${widget_type}-reviews-jsonp`);
        const oldScriptElement = document.getElementById("id", `bizjudge-collections-reviews-widget-jsonp`);

        // Get the head element
        const head = document.getElementsByTagName("head")[0];
        if (oldScriptElement == null) {
            head.appendChild(scriptElement);
        }
        else {
            head.replaceChild(scriptElement, oldScriptElement);
        }
    }

    // for each widget get the business_id, widget_type, product_id (if applicable), per_page (if applicable),
    // sort (if applicable), filter (if applicable)
};

initWidget();

function refreshFeed() {
    sort = document.getElementById("sort-reviews").value;
    filtered = document.querySelector('input[name="ratingValue"]:checked') ? document.querySelector('input[name="ratingValue"]:checked').value : null;
    initWidget(sort, filtered);
}